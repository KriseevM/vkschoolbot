# vkschoolbot
"Школьный" бот для ВКонтакте, который может по запросу написать в ответе расписание, изменения на следующий день или домашнее задание на завтра из специальной базы данных<br >
Базовая настройка бота подразумевает клонирование репозитория, установку зависимостей и дальнейшую настройку. Подробнее в <a href="https://github.com/KriseevM/vkschoolbot/wiki/%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B8-%D0%BF%D0%B5%D1%80%D0%B2%D0%B8%D1%87%D0%BD%D0%B0%D1%8F-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%B1%D0%BE%D1%82%D0%B0">wiki</a>
<h1>API бота</h1>
Так как бот требует постоянного обновления информации в нем, а каждый раз изменять её непосредственно очень неудобно, был разработан специальный API, позволяющий получать информацию из бота (кроме расписания) и изменять эту информацию. Все файлы API хранятся в соответствующей папке - api. Методы делятся на 2 типа:
<ul>
  <li>
    get-методы
  </li>
  <li>
    update-методы
  </li>
</ul>
Первые методы принимают входные данные в виде GET-запросов, содержащих необходимые данные, вторые принимают на вход данные в формате JSON в теле POST-запроса. Результатом работы методов являются json-объекты, содержащие запрашиваемую информацию или сообщение об успешном выполнении операции (или сообщение об ошибке).
<h1>Настройка авторизации для API</h1>
<p>Для работы любого метода API необходима авторизация. Для авторизации необходимо послать POST-запрос с данными логина и пароля скрипту api/auth.php (Атрибут header content-type должен иметь значение application/x-www-form-urlencoded, поля логина и пароля разделены между собой символом переноса строки, имеют имена user и pass соответственно и формат key=value, например, user=Username1). Если данные верны и ключ был успешно создан, то сервер вернёт json: {"key":"здесь будет ваш ключ"}. В противном случае сервер вернёт ошибку в формате json: {"error":"текст ошибки"}. После этого полученный ключ необходимо отправлять вместе с запросом к методу в специальном параметре key. Если ключ неверен, у него истёк срок действия или запрос сделан не с ip-адреса, с которого был создан ключ, то будет возвращена ошибка.  
</p>
<p> Для корректной работы авторизации необходимо настроить базу данных и внести необходимую информацию в переменные файла api/APIInternalInfo.php. База данных для авторизации должна представлять из себя две таблицы. Первая - таблица с пользователями и их паролями, столбцы называются user и pass соответственно. Вторая таблица должна содержать ключи доступа и иметь следующие столбцы (при некоторых указан их тип):
  <ol>
    <li>passkey char(64) - ключ доступа</li>
    <li>user - имя пользователя, для которого создан ключ. Тип может быть любой строковый, можно создать связь с первой таблицей</li>
    <li>ip - ip адрес, с которого создан запрос на получение ключа</li>
    <li>expiration_time int - время в формате unix time, указывающее на срок окончания действия ключа</li>
  </ol>
</p>
<h1>Методы API</h1>
<h2>getChanges.php</h2>
Входные данные: отсутствуют
<br>Выходные данные: json-объект с данными замен, содержащий поля TextChanges и NumericChanges, содержащий в себе данные из файлов changes и NumericChanges соответственно.
<h2>getHomework.php</h2>
Входные данные: id (обязательный, тип - целое число) - содержит уникальный идентификатор предмета в таблице базы данных с заданиями
<br>Выходные данные: json-объект, содержащий поля ID, Subject и Homework, содержащие значения одноименных столбцов таблицы с заданиями в базе данных, находящиеся в строке с ID равным переданному на вход функции.
<h2>getSubjects.php</h2>
Входные данные: отсутствуют
<br>Выходные данные: json, имеющий формат {"id1":"SubjName1","id2":"SubjName2"}, где id1, id2 - целые числа, обозначающие ID предметов в базе данных, а SubjName1 и SubjName2 - названия этих предметов соответственно.
<h2>updateHomework.php</h2>
Входные данные: json-объект, содержащий поля ID и Homework, обозначающие ID предмета в базе данных и новое задание по нему соответственно.
<br>Выходные данные: "{"result":true}" в случае успешного завершения
<h2>updateChanges.php</h2>
Входные данные: json-объект с данными замен, содержащий поля TextChanges и NumericChanges, содержащий в себе данные из файлов changes и NumericChanges соответственно.
<br>Выходные данные: "{"result":true}" в случае успешного завершения
