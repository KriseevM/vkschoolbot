# vkschoolbot
"Школьный" бот для ВКонтакте, который может по запросу написать в ответе расписание, изменения на следующий день или домашнее задание на завтра из специальной базы данных<br >
Чтобы заставить бота работать, нужно перенести все файлы проекта на свой сервер и создать/отредактировать некоторые файлы:
<ul>
  <li>Файлы 1-6 в папке days - расписание по дням недели (1 - понедельник, 2 - вторник и т.д.)</li>
  <li>Файл dbconnectinfo.php - данные для подключения к базе данных MySQL с домашними заданиями (Про саму базу данных <a href="#databaseinfo">см. ниже</a>).</li>
  <li>Файл changes (изменения в расписании на завтра в текстовой форме) и NumericChanges в корневой директории проекта (тоже самое, только для бота), а также файлы с числовым расписанием для бота в папке NumericDays (<a href="#numeric">См. ниже</a>)</li>
</ul>
После всего этого необходимо получить токен своей группы во вкладке "Работа с API" управления сообществом и вставить его в переменную $token в файле APIInfo.php, а также подключить файл main.php как сервер во вкладке Callback API (типы событий: Новое сообщение и Редактирование сообщения. Потребуется также вставить строку подтверждения в переменную $confirmation файла  APIInfo.php). 
<a name="numeric"></a><h1>Файл NumericChanges и файлы в папке NumericDays</h1>
Эти файлы нужны для того, чтобы бот мог правильно выводить домашние задания. Данные в них хранятся в виде набора чисел, разделенных символами переноса строки. Каждое число соответствует ID урока в базе данных. В файлах в папке NumericDays хранится расписание аналогично файлам в папке days (т.е. файлы 1-6 соответственно дням недели: 1 - понедельник, 6 - суббота). В файле NumericChanges должно содержаться 8 строк. Каждая строка соответствует номеру урока по счету в файле из папки NumericDays. Если урок по изменениям пропадает - вместо номера пишется -1 (в английской раскладке), если изменения на конкретный по счету урок нет - вместо номера ставится -2. Т.е. например, завтра понедельник, файл NumericDays/1 содержит следующее:
<pre>
1
2
3
4
5
6
</pre>
А файл NumericChanges содержит следующее:
<pre>
-1
-2
5
7
</pre>
Бот в этом случае выведет домашнее задание по предметам 2, 5, 6, 7, т.е. итоговое расписание будет представлять собой вид:
<pre>
2
5
7
5
6
</pre>
<a name="databaseinfo"></a><h1>База данных с домашними заданиями</h1>
Для работы бота использована СУБД mysql. База данных должна иметь название, соответствующее значению переменной $dbname в файле dbconnectinfo.php. Она должна иметь таблицу "Homeworkdata", состоящую из столбцов "ID", "Subject" и "Homework" для ID предмета, его имени и задания по нему соответственно. ID имеет числовой тип, Subject и Homework имеют любые текстовые типы.
<h1>API бота</h1>
Так как бот требует постоянного обновления информации в нем, а каждый раз изменять её непосредственно очень неудобно, был разработан специальный API, позволяющий получать информацию из бота (кроме расписания) и изменять эту информацию. Все файлы API хранятся в соответствующей папке - api. <b>Доступ к этой папке желательно ограничить</b>. Методы делятся на 2 типа:
<ul>
  <li>
    get-методы
  </li>
  <li>
    update-методы
  </li>
</ul>
Первые методы принимают входные данные в виде GET-запросов, содержащих необходимые данные, вторые принимают на вход данные в формате JSON в теле POST-запроса. Первые методы возвращают json-объекты, а вторые - строку "OK" в случае успешного завершения работы метода.
<h1>Методы API</h1>
<h2>getChanges.php</h2>
Входные данные: отсутствуют
<br>Выходные данные: json-объект с данными замен, содержащий поля TextChanges и NumericChanges, содержащий в себе данные из файлов changes и NumericChanges соответственно.
<h2>getHomework.php</h2>
Входные данные: id (обязательный, тип - целое число) - содержит уникальный идентификатор предмета в таблице базы данных с заданиями
<br>Выходные данные: json-объект, содержащий поля ID, Subject и Homework, содержащие значения одноименных столбцов таблицы с заданиями в базе данных, находящиеся в строке с ID равным переданному на вход функции.
<h2>getSubjects.php</h2>
Входные данные: отсутствуют
<br>Выходные данные: json, имеющий формат {"id1":"SubjName1","id2":"SubjName2"}, где id1, id2 - целые числа, обозначающие ID предметов в базе данных, а SubjName1 и SubjName2 - названия этих предметов соответственно.
<h2>updateHomework.php</h2>
Входные данные: json-объект, содержащий поля ID и Homework, обозначающие ID предмета в базе данных и новое задание по нему соответственно.
<br>Выходные данные: "OK" в случае успешного завершения
<h2>updateChanges.php</h2>
Входные данные: json-объект с данными замен, содержащий поля TextChanges и NumericChanges, содержащий в себе данные из файлов changes и NumericChanges соответственно.
<br>Выходные данные: "OK" в случае успешного завершения
